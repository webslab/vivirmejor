---
import Link from './Link.astro'

import { Image } from 'astro:assets'
import brand from '$images/logovivirmejor01b.png'

interface Props {
  loginSelector: string;
};

const { loginSelector } = Astro.props;
---

<style>
.nav-item {
  margin: 0 0.7rem;
}

/* Forzar que la navbar siempre mantenga el mismo aspecto */
.navbar {
  background-color: #d4d4d4 !important;
}

/* Asegurar que los textos de los enlaces se vean bien siempre */
.navbar .nav-link {
  color: #333 !important;
}

.navbar .nav-link:hover {
  color: #46a2a8 !important;
}

.navbar .nav-link.disabled {
  color: #999 !important;
}

/* Dropdown mantiene colores consistentes */
.dropdown-menu {
  background-color: #fff !important;
  border: 1px solid #ddd !important;
}

.dropdown-item {
  color: #333 !important;
}

.dropdown-item:hover {
  background-color: #f8f9fa !important;
  color: #46a2a8 !important;
}

.dropdown-item.disabled {
  color: #999 !important;
}

/* Botón hamburguesa para móviles */
.navbar-toggler {
  border-color: #333 !important;
}

.navbar-toggler-icon {
  background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba%2833, 37, 41, 0.75%29' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e") !important;
}

/* Iconos del selector de temas */
.list-group-item {
  background-color: #f8f9fa !important;
  border-color: #ddd !important;
  color: #333 !important;
}

.list-group-item:hover {
  background-color: #e9ecef !important;
}

.list-group-item.active {
  background-color: #46a2a8 !important;
  border-color: #46a2a8 !important;
  color: white !important;
}

/* Divisor del dropdown */
.dropdown-divider {
  border-color: #ddd !important;
}

/* Estilos para el botón de tema con solo icono sin flecha */
.theme-toggle {
  background: none !important;
  border: none !important;
  padding: 0.4rem !important;
  color: #333 !important;
  margin-left: 1rem !important; /* Más separación de Acceso */
}

.theme-toggle:hover {
  color: #46a2a8 !important;
}

.theme-toggle:focus {
  box-shadow: none !important;
}

/* Quitar la flecha del dropdown */
.theme-toggle::after {
  display: none !important;
}

/* Icono del sol más pequeño */
.theme-toggle svg {
  width: 16px !important;
  height: 16px !important;
}
</style>

<nav class="navbar navbar-expand-lg shadow-sm fixed-top">

  <div class="container-xxl bd-gutter flex-wrap flex-lg-nowrap">
    <a
      class="navbar-brand"
      href="/">
      <Image
        class="image-fluid w-100"
        style="max-height: 2.5rem"
        src={brand}
        format={'webp'}
        widths={[200]}
        sizes={`200px`}
        alt="Project Brand"/>
    </a>

    <button
      class="navbar-toggler ms-auto"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent"
      aria-expanded="false"
      aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div
      class="collapse navbar-collapse justify-content-end"
      id="navbarSupportedContent">
      <ul class="navbar-nav mb-2 mb-lg-0 text-end">
        <li class="nav-item">
          <Link
            class="nav-link"
            href="/">
            Inicio
          </Link>
        </li>

        <li class="nav-item">
          <Link
            class="nav-link"
            href="/about/">
            Equipo
          </Link>
        </li>

        <!-- <li class="nav-item">
          <Link
            class="nav-link"
            href="/content/blog/">
            Blog
          </Link>
        </li> -->

        <li class="nav-iteam">
          <Link
            id="nav-modules"
            class="nav-link disabled"
            href="/content/modules/">
            Módulos
          </Link>
        </li>

        <li class="nav-item dropdown ms-5">
          <a
            class="nav-link dropdown-toggle"
            role="button"
            data-bs-toggle="dropdown"
            aria-expanded="false"
            href="#">
            Acceso
          </a>

          <ul
            style="min-width: 200px"
            class="dropdown-menu dropdown-menu-end">
            <li data-admin class="d-none">
              <a
                class="dropdown-item"
                href="/auth/admin/">
                Admin
              </a>
            </li>

            <li data-admin class="d-none"><hr class="dropdown-divider" /></li>

            <li>
              <a
                type="button"
                id="nav-login"
                data-bs-toggle="modal"
                data-bs-target={loginSelector}
                class="dropdown-item">
                Login
              </a>
            </li>

            <li>
              <a
                id="nav-logout"
                onclick="
                  localStorage.removeItem('token')
                  localStorage.removeItem('user')

                  window.location.href = '/'
                "
                class="dropdown-item disabled">
                Logout
              </a>
            </li>
          </ul>
        </li>

        <!-- Botón de selector de temas después de Acceso, sin flecha y sin borde -->
        <li class="nav-item dropdown ms-3">
          <button
            class="btn theme-toggle"
            type="button"
            data-bs-toggle="dropdown"
            aria-expanded="false"
            aria-label="Selector de tema">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-sun" viewBox="0 0 16 16">
              <path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6m0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8M8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0m0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13m8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5M3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8m10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0m-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0m9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707M4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708"/>
            </svg>
          </button>

          <ul class="dropdown-menu dropdown-menu-end">
            <li class="px-2">
              <ul
                id="bd-theme"
                class="list-group list-group-horizontal justify-content-center">

                <li
                  data-bs-theme-value="light"
                  class="list-group-item py-1 px-2">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-sun" viewBox="0 0 16 16">
                    <path d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6m0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8M8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0m0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13m8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5M3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8m10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0m-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0m9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707M4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708"/>
                  </svg>
                </li>

                <li
                  data-bs-theme-value="dark"
                  class="list-group-item py-1 px-2">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-moon" viewBox="0 0 16 16">
                    <path d="M6 .278a.77.77 0 0 1 .08.858 7.2 7.2 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277q.792-.001 1.533-.16a.79.79 0 0 1 .81.316.73.73 0 0 1-.031.893A8.35 8.35 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.75.75 0 0 1 6 .278M4.858 1.311A7.27 7.27 0 0 0 1.025 7.71c0 4.02 3.279 7.276 7.319 7.276a7.32 7.32 0 0 0 5.205-2.162q-.506.063-1.029.063c-4.61 0-8.343-3.714-8.343-8.290 0-1.167.242-2.278.681-3.286"/>
                  </svg>
                </li>
              </ul>
            </li>
          </ul>
        </li>
      </ul>

      <script>
        import { authService } from '$lib/services/auth.ts'

        const navLogin = document.getElementById('nav-login')
        const navAdmin = document.querySelectorAll('[data-admin]')
        const navLogout = document.getElementById('nav-logout')
        const navModules = document.getElementById('nav-modules')

        document.addEventListener('DOMContentLoaded', async () => {
          try {
            await authService.isReady

            if (authService.isAuthenticated()) {
              navLogin.classList.add('disabled')
              navLogout.classList.remove('disabled')
              navModules.classList.remove('disabled')
            } else {
              navLogin.classList.remove('disabled')
              navLogout.classList.add('disabled')
              navModules.classList.add('disabled')
            }

            if (authService.isAuthenticated() && authService.isAdministrator()) {
              navAdmin.forEach((el) => el.classList.remove('d-none'))
            } else {
              navAdmin.forEach((el) => el.classList.add('d-none'))
            }
          } catch (error) {
            console.error(error)
          }
        })
      </script>

    </div>
  </div>
</nav>

<script>
  import 'bootstrap/js/dist/collapse'
  import 'bootstrap/js/dist/dropdown'
</script>
