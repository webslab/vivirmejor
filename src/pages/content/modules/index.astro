---
import BaseLayout from '$layouts/Base.astro'
---

<style is:global>
@font-face {
  font-family: 'Approach';
  src: url('/fonts/Approach-Regular.otf') format('opentype');
  font-weight: 400;
  font-style: normal;
}

@font-face {
  font-family: 'Approach';
  src: url('/fonts/Approach-Medium.otf') format('opentype');
  font-weight: 500;
  font-style: normal;
}

@font-face {
  font-family: 'Approach';
  src: url('/fonts/Approach-Bold.otf') format('opentype');
  font-weight: 700;
  font-style: normal;
}

#posts-list {
  min-height: 100svh;
  margin-top: 3rem;
}

#posts-list li * {
  transition: all 0.5s;
}

#posts-list li {
  max-width: 400px;
  margin: 2rem;
}

li a img {
  border: 2px solid transparent;
  filter: grayscale(50%);
  object-fit: cover;
  aspect-ratio: 1 / 1;
}

li a:hover img {
  border: 2px solid var(--bs-primary);
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.7);
  filter: grayscale(0);
}

li a p {
  word-wrap: break-word;
  line-height: 1.3;
  margin-top: 1.25rem;
  font-family: 'Approach', sans-serif;
  color: #46a2a8;
  font-weight: 700;
  font-size: 1.5rem;
}

li a:hover p {
  color: #46a2a8;
}
</style>

<BaseLayout
  auth={true}
  admin={false}
  title="MÃ³dulos"
  description="Great content for you">
  <ul
    class="d-flex flex-wrap justify-content-center m-0 p-0 list-unstyled"
    id="posts-list"></ul>
</BaseLayout>

<script>
  import { authService } from '$lib/services/auth.ts'
  import type { Module } from '$lib/types.ts'

  const postsList = document.getElementById('posts-list')

  authService.isReady.then(async() => {
    const res: Module[][] = await authService
      .getDb()
      .query('SELECT hero,title,slug,publish FROM module WHERE !draft AND publish < time::now() ORDER BY publish ASC;')

    for (const post of res[0]) {
      const li = document.createElement('li')
      li.innerHTML = `
        <a
          class="d-block text-center text-decoration-none"
          aria-label=${post.title}
          href=/content/modules/module?slug=${post.slug}>
          <img
            class="img-fluid rounded"
            src=${post.hero}
            alt=${post.title}
            width="400"
            height="400"
            loading="lazy"
          />

          <p>
            ${post.title}
          </p>
        </a>
      `

      postsList.appendChild(li)
    }
  })
</script>
